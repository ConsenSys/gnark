#!/usr/bin/env sage

import sys
from sage.all import *

# Compute the result of a multi-exponentiation in the G1, G2 torsion groups of bls377

# set numPoints as desired
numPoints=100

# bls377 fp modulus
p=258664426012969094010652733694893533536393512754914660539884262666720468348340822774968888139573360124440321458177

# bls377 fr modulus
r=8444461749428370424248824938781546531375899335154063827935233455917409239041

# large multiplicative generator of fr
exp=7716837800905789770901243404444209691916730933998574719964609384059111546487

#
# G1
#
Fp=GF(p)
E=EllipticCurve(Fp, [0,1])

# generator of torsion group G1 with order r
G1=E(68333130937826953018162399284085925021577172705782285525244777453303237942212457240213897533859360921141590695983,243386584320553125968203959498080829207604143167922579970841210259134422887279629198736754149500839244552761526603)

R1=G1-G1 # initialize point at infinity
nextpoint=R1
nextscalar=1
for i in range(numPoints):
    nextpoint = nextpoint + G1
    nextscalar = nextscalar * exp % r
    R1 = R1 + nextscalar * nextpoint
print "G1:", numPoints, R1

#
# G2
#
Fp2.<u> = GF(p^2, modulus=x^2-5)
Etwist = EllipticCurve(Fp2, [0, u^-1])

# generator of torsion group G2 with order r
G2 = Etwist([129200027147742761118726589615458929865665635908074731940673005072449785691019374448547048953080140429883331266310+218164455698855406745723400799886985937129266327098023241324696183914328661520330195732120783615155502387891913936*u, 178797786102020318006939402153521323286173305074858025240458924050651930669327663166574060567346617543016897467207+246194676937700783734853490842104812127151341609821057456393698060154678349106147660301543343243364716364400889778*u])

R2=G2-G2 # initialize point at infinity
nextpoint=R2
nextscalar=1
for i in range(numPoints):
    nextpoint = nextpoint + G2
    nextscalar = nextscalar * exp % r
    R2 = R2 + nextscalar * nextpoint
print "G2:", numPoints, R2

#
# G1 edge cases
#
P1 = E(85879744602667658250966591634699201835417871354199350447425773317569135331328512761239181166577095285394145243344, 67444726947140534012984174182267272049099350988434085667660879056432250795670298159879333367207157893146043596329)
s = 115792089237316195423570985008687907853269984665640564039457584007913129639935
print "maxuint*P1:", s*P1

#
# G2 edge cases
#
P2 = Etwist(38348804106969641131654336618231918247608720362924380120333996440589719997236048709530218561145001033408367199467 + 208837221672103828632878568310047865523715993428626260492233587961023171407529159232705047544612759994485307437530*u, 219129261975485221488302932474367447253380009436652290437731529751224807932621384667224625634955419310221362804739 + 62857965187173987050461294586432573826521562230975685098398439555961148392353952895313161290735015726193379258321*u)
s = 115792089237316195423570985008687907853269984665640564039457584007913129639935
print "maxuint*P2:", s*P2
